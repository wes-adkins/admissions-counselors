<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Campus Counselor Finder (Prototype)</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    :root {
      --iwu-navy: #0b1f3b;
    }
    body { background: #f7f8fa; }
    .brand-bar { background: var(--iwu-navy); color: #fff; }
    .step-card { border: 0; border-radius: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,.06); }
    .option-btn { border-radius: .9rem; }
    .progress-pill { font-size: .85rem; }
    /* Map container stays responsive and preserves aspect ratio */
    /* Do not clip the SVG vertically on large screens */
    .map-card { overflow: visible; }

    #map-wrap { width: 100%; height: auto; }

    #map-wrap svg {
      width: 100%;
      height: auto;
      display: block;
      max-height: none;
    }

    /* Interaction styling */
    #map-wrap svg [id],
    #map-wrap svg path,
    #map-wrap svg polygon,
    #map-wrap svg g {
      cursor: pointer;
      transition: fill 120ms ease, opacity 120ms ease;
    }

    /* Default state color */
    #map-wrap svg .state-shape {
      fill: #a6192e !important;
      outline: none !important;
    }

    /* Hover color */
    #map-wrap svg .state-shape:hover {
      fill: #701d29 !important;
      opacity: 1;
    }

    /* Remove browser focus ring */
    #map-wrap svg .state-shape:focus,
    #map-wrap svg .state-shape:focus-visible {
      outline: none !important;
      box-shadow: none !important;
    }

    .max100 { max-width: 100%; border-radius: 5px; }

    .counselor_details {
      background: #f4f4f4;
      border-bottom-right-radius: 6px;
      border-bottom-left-radius: 6px;
      padding: 30px;
      border-top: 8px solid #982832;
    }

    .counselor_details strong { font-size: 1.5rem; }

    @media (max-width: 600px) {
      .max100 { margin-bottom: 30px; max-width: 65%; }
    }
    .muted-note { color: #5b6676; }

    /* Simple max-height collapse animation (keeps content in DOM for indexing) */
    .collapse-animate {
      overflow: hidden;
      transition: max-height .35s ease, opacity .25s ease;
    }
    .collapse-hidden {
      max-height: 0;
      opacity: 0;
    }
    .collapse-visible {
      max-height: 1000px;
      opacity: 1;
    }

    /* Freshman map styles */
    .map-card { overflow: visible; }

    #map-wrap { width: 100%; height: auto; }

    #map-wrap svg {
      width: 100%;
      height: auto;
      display: block;
      max-height: none;
    }

    #map-wrap svg [id],
    #map-wrap svg path,
    #map-wrap svg polygon,
    #map-wrap svg g {
      cursor: pointer;
      transition: fill 120ms ease, opacity 120ms ease;
    }

    #map-wrap svg .state-shape {
      fill: #a6192e !important;
      outline: none !important;
    }

    #map-wrap svg .state-shape:hover {
      fill: #701d29 !important;
      opacity: 1;
    }

    #map-wrap svg .state-shape:focus,
    #map-wrap svg .state-shape:focus-visible {
      outline: none !important;
      box-shadow: none !important;
    }

    .max100 { max-width: 100%; border-radius: 5px; }

    .counselor_details {
      background: #f4f4f4;
      border-bottom-right-radius: 6px;
      border-bottom-left-radius: 6px;
      padding: 30px;
      border-top: 8px solid #982832;
    }

    .counselor_details i { margin-right: 5px; }

    .counselor_details strong { font-size: 1.5rem; }

    @media (max-width: 600px) {
      .max100 { margin-bottom: 30px; max-width: 65%; }
    }
  </style>
</head>

<body>
  <header class="brand-bar py-3">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between gap-3">
        <div>
          <div class="h4 mb-0">Find Your Admissions Counselor</div>
          <div class="small opacity-75">Step-through prototype replacing the counselor rows list</div>
        </div>
        <button id="btnRestart" class="btn btn-outline-light btn-sm" type="button">Restart</button>
      </div>
    </div>
  </header>

  <main class="container my-4 my-lg-5">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-9 col-xl-8">

        <!-- Progress -->
        <div class="d-flex align-items-center justify-content-between mb-3">
          <span id="progressLabel" class="badge text-bg-secondary progress-pill">Step 1 of 2</span>
          <button id="btnBack" class="btn btn-link text-decoration-none px-0" type="button" style="visibility:hidden;">← Back</button>
        </div>

        <div class="card step-card">
          <div class="card-body p-4 p-lg-5">

            <!-- STEP 1 -->
            <section id="step1" class="step">
              <h1 class="h3">Who are you?</h1>
              <p class="muted-note mb-4">Choose the option that best fits your situation.</p>

              <!-- In-card path header (hidden until a path is selected) -->
              <div id="pathHeader" class="alert alert-light border d-flex align-items-center justify-content-between gap-3 d-none" style="border-radius:1rem;">
                <div class="fw-semibold" id="pathHeaderText">You have selected</div>
                <a href="#" id="pathStartOver" class="small text-decoration-none">Start over</a>
              </div>

              <div class="d-grid gap-3">
                <button class="btn btn-light border option-btn text-start p-3" type="button" data-step1="first-time">
                  <div class="fw-semibold">First-time IWU Student</div>
                  <div class="small text-muted">I am applying for the first time</div>
                </button>

                <button class="btn btn-light border option-btn text-start p-3" type="button" data-step1="current-past">
                  <div class="fw-semibold">Current or Past IWU Student</div>
                  <div class="small text-muted">I have attended or I am currently enrolled</div>
                </button>
              </div>
            </section>

            <!-- STEP 2A: First-time -->
            <section id="step2A" class="step" hidden>
              <h2 class="h3">What type of student are you?</h2>
              <p class="muted-note mb-4">Select how you plan to attend Indiana Wesleyan University.</p>

              <div class="row g-2 align-items-end mb-3">
                <div class="col">
                  <label for="firstTimeType" class="form-label fw-semibold">Student type</label>
                  <select id="firstTimeType" class="form-select">
                    <option value="" selected disabled>Select one</option>
                    <option value="freshman">First-time Freshman</option>
                    <option value="transfer">Transfer Students</option>
                    <option value="international">International Students</option>
                    <option value="graduate">Graduate Students (Residential Masters and Doctorate Degrees)</option>
                    <option value="tck-mk">Third Culture Kids (TCK) and Missionary Kids (MK)</option>
                    <option value="dual">Dual Citizenship, DACA, and TPS Students</option>
                  </select>
                </div>
                <div class="col-auto">
                  <button id="clearFirstTime" type="button" class="btn btn-outline-secondary" hidden>Clear</button>
                </div>
              </div>

              <!-- Pre-rendered First-time Counselor Sections (SEO-safe) -->
              <div id="resultFirstTime" class="mt-4">

                <!-- Freshman Map -->
                <section data-ft="freshman" class="collapse-animate collapse-hidden" hidden>

  <!-- MAP VIEW -->
  <div id="freshmanMapView">
    <div class="card shadow-sm map-card" style="border-radius:1rem;">
      <div class="card-header d-flex align-items-center justify-content-between" style="border-top-left-radius:1rem;border-top-right-radius:1rem;">
        <div>
          <div class="fw-semibold">Where are you from?</div>
          <div class="text-body-secondary small">Click a state to find your Admissions Counselor</div>
        </div>
        <button id="btn-reset" type="button" class="btn btn-outline-secondary btn-sm">Reset</button>
      </div>
      <div class="card-body">
        <div id="map-status" class="alert alert-info py-2 small mb-3">Loading map…</div>
        <div class="bg-white border rounded p-2">
          <div id="map-wrap" aria-label="Clickable map of the United States"></div>
        </div>
      </div>
    </div>
  </div>

   <!-- RESULT VIEW -->
  <div id="freshmanResultView" hidden>
    <a href="#" id="backToMap" class="small text-decoration-none d-inline-block mb-2">← Back to map</a>
  
    <div id="freshmanIndianaControls" class="mb-3" hidden>
      <label for="freshmanCountySelect" class="form-label fw-semibold">Select your Indiana county</label>
      <select id="freshmanCountySelect" class="form-select">
        <option value="" selected>Select a county…</option>
      </select>
    </div>
  
    <div id="freshmanResultHost"></div>
  </div>


</section>

                <!-- Transfer -->
                <section data-ft="transfer" class="collapse-animate collapse-hidden" hidden>
                  <div class="card border-0 bg-light" style="border-radius:1rem;">
                    <div class="card-body p-4">
                      <div class="h5">Transfer Students</div>
                      <p class="text-muted mb-3">Are you considering a move to Indiana Wesleyan from another college or university? We'd love to chat. Reach out today!</p>
                      <div class="d-flex align-items-start gap-3">
                        <img src="https://www.indwes.edu/admissions/campus/_img/Brittany-Moser-headshot.jpg" alt="Brittany Moser headshot" class="rounded-circle flex-shrink-0" style="width:72px;height:72px;object-fit:cover;" />
                        <div>
                          <div class="fw-semibold">Brittany Moser</div>
                          <div class="small">Email: <a href="mailto:brittany.moser@indwes.edu">brittany.moser@indwes.edu</a></div>
                          <div class="small">Phone: <a href="tel:+17656772365">765-677-2365</a></div>
                        </div>
                      </div>
                      <div class="d-flex flex-wrap gap-2 mt-3">
                        <a class="btn btn-primary" href="https://outlook.office.com/bookwithme/user/9c75f0e3006b479d87343b7b33463151%40indwes.edu/meetingtype/65de897c-4845-40e6-b75d-e69b207539c4?anonymous=" role="button">Schedule a Chat</a>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- International -->
                <section data-ft="international" class="collapse-animate collapse-hidden" hidden>
                  <div class="card border-0 bg-light" style="border-radius:1rem;">
                    <div class="card-body p-4">
                      <div class="h5">International Students</div>
                      <p class="text-muted mb-3">Are you an international student interested in studying at Indiana Wesleyan? We're here to answer your questions and help get you started!</p>
                      <div class="d-flex align-items-start gap-3">
                        <img src="https://www.indwes.edu/admissions/campus/_img/Tony-Stevens-headshot.jpg" alt="Tony Stevens headshot" class="rounded-circle flex-shrink-0" style="width:72px;height:72px;object-fit:cover;" />
                        <div>
                          <div class="fw-semibold">Tony Stevens</div>
                          <div class="small">Email: <a href="mailto:tony.stevens@indwes.edu">tony.stevens@indwes.edu</a></div>
                          <div class="small">Phone: <a href="tel:+17656772921">765-677-2921</a></div>
                        </div>
                      </div>
                      <div class="d-flex flex-wrap gap-2 mt-3">
                        <a class="btn btn-primary" href="https://calendly.com/tony-stevens-6im_/30min" role="button">Schedule a Chat</a>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- Graduate -->
                <section data-ft="graduate" class="collapse-animate collapse-hidden" hidden>
                  <div class="card border-0 bg-light" style="border-radius:1rem;">
                    <div class="card-body p-4">
                      <div class="h5">Graduate Students (Residential Masters and Doctorate Degrees)</div>
                      <div class="d-flex align-items-start gap-3">
                        <img src="https://www.indwes.edu/admissions/campus/_img/laura-marine.webp" alt="Laura Marine headshot" class="rounded-circle flex-shrink-0" style="width:72px;height:72px;object-fit:cover;" />
                        <div>
                          <div class="fw-semibold">Laura Marine</div>
                          <div class="small">Email: <a href="mailto:laura.marine@indwes.edu">laura.marine@indwes.edu</a></div>
                          <div class="small">Phone: <a href="tel:+17656772572">765-677-2572</a></div>
                        </div>
                      </div>
                      <p class="small text-muted mt-2 mb-0">Serving students with interest in the Doctor of Physical Therapy program and the Doctor of Occupational Therapy program.</p>
                      <div class="d-flex flex-wrap gap-2 mt-3">
                        <a class="btn btn-primary" href="mailto:laura.marine@indwes.edu" role="button">Email Laura</a>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- TCK and MK -->
                <section data-ft="tck-mk" class="collapse-animate collapse-hidden" hidden>
                  <div class="card border-0 bg-light" style="border-radius:1rem;">
                    <div class="card-body p-4">
                      <div class="h5">Third Culture Kids (TCK) and Missionary Kids (MK)</div>
                      <p class="text-muted mb-3">Are you a Third Culture or Missionary Kid? Our team is here to serve you!</p>
                      <div class="d-flex align-items-start gap-3">
                        <img src="https://www.indwes.edu/admissions/campus/_img/Tony-Stevens-headshot.jpg" alt="Tony Stevens headshot" class="rounded-circle flex-shrink-0" style="width:72px;height:72px;object-fit:cover;" />
                        <div>
                          <div class="fw-semibold">Tony Stevens</div>
                          <div class="small">Email: <a href="mailto:tony.stevens@indwes.edu">tony.stevens@indwes.edu</a></div>
                          <div class="small">Phone: <a href="tel:+17656772921">765-677-2921</a></div>
                        </div>
                      </div>
                      <div class="d-flex flex-wrap gap-2 mt-3">
                        <a class="btn btn-primary" href="https://calendly.com/tony-stevens-6im_/30min" role="button">Schedule a Chat</a>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- Dual, DACA, TPS -->
                <section data-ft="dual" class="collapse-animate collapse-hidden" hidden>
                  <div class="card border-0 bg-light" style="border-radius:1rem;">
                    <div class="card-body p-4">
                      <div class="h5">Dual Citizenship, DACA, and TPS Students</div>
                      <div class="d-flex align-items-start gap-3">
                        <img src="https://www.indwes.edu/admissions/campus/_img/Tony-Stevens-headshot.jpg" alt="Tony Stevens headshot" class="rounded-circle flex-shrink-0" style="width:72px;height:72px;object-fit:cover;" />
                        <div>
                          <div class="fw-semibold">Tony Stevens</div>
                          <div class="small">Email: <a href="mailto:tony.stevens@indwes.edu">tony.stevens@indwes.edu</a></div>
                          <div class="small">Phone: <a href="tel:+17656772921">765-677-2921</a></div>
                        </div>
                      </div>
                      <div class="d-flex flex-wrap gap-2 mt-3">
                        <a class="btn btn-primary" href="https://calendly.com/tony-stevens-6im_/30min" role="button">Schedule a Chat</a>
                      </div>
                    </div>
                  </div>
                </section>

              </div>
            </section>

            <!-- STEP 2B: Current/Past -->
            <section id="step2B" class="step" hidden>
              <h2 class="h3">What are you looking to do?</h2>
              <p class="muted-note mb-4">Select the option that best describes your situation.</p>

              <div class="row g-2 align-items-end mb-3">
                <div class="col">
                  <label for="currentPastType" class="form-label fw-semibold">Select an option</label>
                  <select id="currentPastType" class="form-select">
                    <option value="" selected disabled>Select one</option>
                    <option value="readmit">Seeking Readmission to IWU-Marion</option>
                    <option value="online-to-campus">Transition from Online to On-Campus</option>
                  </select>
                </div>
                <div class="col-auto">
                  <button id="clearCurrentPast" type="button" class="btn btn-outline-secondary" hidden>Clear</button>
                </div>
              </div>

              <div id="resultCurrentPast" class="mt-4">

                <!-- Pre-rendered Current/Past Counselor Sections (SEO-safe) -->
                <section data-cp="readmit" class="collapse-animate collapse-hidden" hidden>
                  <div class="card border-0 bg-light" style="border-radius:1rem;">
                    <div class="card-body p-4">
                      <div class="h5">Seeking Readmission to IWU-Marion</div>
                      <p class="text-muted mb-3">Are you prior IWU student and ready to come back? Tony is here to help!</p>
                      <div class="d-flex align-items-start gap-3">
                        <img src="https://www.indwes.edu/admissions/campus/_img/Tony-Stevens-headshot.jpg" alt="Tony Stevens headshot" class="rounded-circle flex-shrink-0" style="width:72px;height:72px;object-fit:cover;" />
                        <div>
                          <div class="fw-semibold">Tony Stevens</div>
                          <div class="small">Email: <a href="mailto:tony.stevens@indwes.edu">tony.stevens@indwes.edu</a></div>
                          <div class="small">Phone: <a href="tel:+17656772921">765-677-2921</a></div>
                        </div>
                      </div>
                      <div class="d-flex flex-wrap gap-2 mt-3">
                        <a class="btn btn-primary" href="https://calendly.com/tony-stevens-6im_/30min" role="button">Schedule a Chat</a>
                      </div>
                    </div>
                  </div>
                </section>

                <section data-cp="online-to-campus" class="collapse-animate collapse-hidden" hidden>
                  <div class="card border-0 bg-light" style="border-radius:1rem;">
                    <div class="card-body p-4">
                      <div class="h5">Transition from Online to On-Campus</div>
                      <p class="text-muted mb-3">Are you a current IWU N and G (online) student and interested in attending the Marion campus? The transition to our beautiful Marion campus is quick and easy!</p>
                      <div class="d-flex align-items-start gap-3">
                        <img src="https://www.indwes.edu/admissions/campus/_img/Tony-Stevens-headshot.jpg" alt="Tony Stevens headshot" class="rounded-circle flex-shrink-0" style="width:72px;height:72px;object-fit:cover;" />
                        <div>
                          <div class="fw-semibold">Tony Stevens</div>
                          <div class="small">Email: <a href="mailto:tony.stevens@indwes.edu">tony.stevens@indwes.edu</a></div>
                          <div class="small">Phone: <a href="tel:+17656772921">765-677-2921</a></div>
                        </div>
                      </div>
                      <div class="d-flex flex-wrap gap-2 mt-3">
                        <a class="btn btn-primary" href="https://calendly.com/tony-stevens-6im_/30min" role="button">Schedule a Chat</a>
                      </div>
                    </div>
                  </div>
                </section>

              </div>
            </section>

          </div>
        </div>

        <p class="small text-muted mt-3 mb-0">
          Prototype notes: This is a UI mockup. Wire in the real counselor data and map embed where indicated.
        </p>

      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const step1 = document.getElementById('step1');
    const step2A = document.getElementById('step2A');
    const step2B = document.getElementById('step2B');

    const btnBack = document.getElementById('btnBack');
    const btnRestart = document.getElementById('btnRestart');
    const progressLabel = document.getElementById('progressLabel');

    const firstTimeType = document.getElementById('firstTimeType');
    const currentPastType = document.getElementById('currentPastType');

    const resultFirstTime = document.getElementById('resultFirstTime');
    const resultCurrentPast = document.getElementById('resultCurrentPast');

    const clearFirstTime = document.getElementById('clearFirstTime');
    const clearCurrentPast = document.getElementById('clearCurrentPast');

    const pathHeader = document.getElementById('pathHeader');
    const pathHeaderText = document.getElementById('pathHeaderText');
    const pathStartOver = document.getElementById('pathStartOver');

    let path = null; // 'first-time' or 'current-past'

    function animateClose(section) {
      section.classList.remove('collapse-visible');
      section.classList.add('collapse-hidden');
      window.setTimeout(() => { section.hidden = true; }, 220);
    }

    function animateOpen(section) {
      section.hidden = false;
      window.requestAnimationFrame(() => {
        section.classList.remove('collapse-hidden');
        section.classList.add('collapse-visible');
      });
    }

    function hideAll(containerEl, selector) {
      containerEl.querySelectorAll(selector).forEach(section => {
        if (!section.hidden) {
          animateClose(section);
        } else {
          section.classList.add('collapse-hidden');
          section.classList.remove('collapse-visible');
          section.hidden = true;
        }
      });
    }

    function showOne(containerEl, selector, valueAttr, value) {
      hideAll(containerEl, selector);
      if (!value) return;
      const active = containerEl.querySelector(`[${valueAttr}="${value}"]`);
      if (active) animateOpen(active);
    }

    function setPathHeader(nextPath) {
      if (!nextPath) {
        pathHeader.classList.add('d-none');
        pathHeaderText.textContent = 'You have selected';
        return;
      }

      const label = nextPath === 'first-time'
        ? 'First-time IWU Student'
        : 'Current or Past IWU Student';

      pathHeaderText.textContent = `You have selected ${label}`;
      pathHeader.classList.remove('d-none');
    }

    function showStep1() {
      path = null;
      step1.hidden = false;
      step2A.hidden = true;
      step2B.hidden = true;
      btnBack.style.visibility = 'hidden';
      progressLabel.textContent = 'Step 1 of 2';

      setPathHeader(null);

      firstTimeType.value = '';
      currentPastType.value = '';

      clearFirstTime.hidden = true;
      clearCurrentPast.hidden = true;

      // Do not remove content from the DOM (SEO-safe)
      hideAll(resultFirstTime, '[data-ft]');
      hideAll(resultCurrentPast, '[data-cp]');
    }

    function showStep2(which) {
      path = which;
      step1.hidden = true;
      step2A.hidden = which !== 'first-time';
      step2B.hidden = which !== 'current-past';
      btnBack.style.visibility = 'visible';
      progressLabel.textContent = 'Step 2 of 2';

      setPathHeader(which);

      // Clean slate when switching paths
      if (which === 'first-time') {
        currentPastType.value = '';
        clearCurrentPast.hidden = true;
        hideAll(resultCurrentPast, '[data-cp]');
      }

      if (which === 'current-past') {
        firstTimeType.value = '';
        clearFirstTime.hidden = true;
        hideAll(resultFirstTime, '[data-ft]');
      }
    }

    function renderFirstTime(value) {
      clearFirstTime.hidden = !value;
      showOne(resultFirstTime, '[data-ft]', 'data-ft', value);
      if (value === 'freshman') initFreshmanMapOnce();
    }

    function renderCurrentPast(value) {
      clearCurrentPast.hidden = !value;
      showOne(resultCurrentPast, '[data-cp]', 'data-cp', value);
    }

    document.querySelectorAll('[data-step1]').forEach(btn => {
      btn.addEventListener('click', () => {
        const which = btn.getAttribute('data-step1');
        showStep2(which);
      });
    });

    btnBack.addEventListener('click', showStep1);
    btnRestart.addEventListener('click', showStep1);

    pathStartOver.addEventListener('click', (e) => {
      e.preventDefault();
      showStep1();
    });

    clearFirstTime.addEventListener('click', () => {
      firstTimeType.value = '';
      clearFirstTime.hidden = true;
      hideAll(resultFirstTime, '[data-ft]');
    });

    clearCurrentPast.addEventListener('click', () => {
      currentPastType.value = '';
      clearCurrentPast.hidden = true;
      hideAll(resultCurrentPast, '[data-cp]');
    });

    firstTimeType.addEventListener('change', (e) => renderFirstTime(e.target.value));
    currentPastType.addEventListener('change', (e) => renderCurrentPast(e.target.value));

    // Freshman map initialization
    let freshmanMapInitialized = false;

function initFreshmanMapOnce() {
  if (freshmanMapInitialized) return;

  const mapWrap = document.getElementById('map-wrap');
  const statusEl = document.getElementById('map-status');
  const resetBtn = document.getElementById('btn-reset');

  const freshmanMapView = document.getElementById('freshmanMapView');
  const freshmanResultView = document.getElementById('freshmanResultView');
  const backToMap = document.getElementById('backToMap');
  const resultHost = document.getElementById('freshmanResultHost');
  const indianaControls = document.getElementById('freshmanIndianaControls');
  const countySelect = document.getElementById('freshmanCountySelect');

  if (!mapWrap || !statusEl || !resetBtn || !freshmanMapView || !freshmanResultView || !backToMap || !resultHost || !indianaControls || !countySelect) return;

  freshmanMapInitialized = true;

  const SVG_URL = 'https://upload.wikimedia.org/wikipedia/commons/1/1a/Blank_US_Map_%28states_only%29.svg';

  let selectedStateEl = null;

  function setStatus(kind, text) {
    statusEl.className = 'alert py-2 small mb-3';
    statusEl.classList.add(kind === 'error' ? 'alert-danger' : kind === 'success' ? 'alert-success' : 'alert-info');
    statusEl.textContent = text;
  }

  function clearSelectedState() {
    if (selectedStateEl) selectedStateEl.classList.remove('is-selected');
    selectedStateEl = null;
  }

  function escapeHtml(str) {
    return String(str)
      .replaceAll('&', '&amp;')
      .replaceAll('<', '&lt;')
      .replaceAll('>', '&gt;')
      .replaceAll('"', '&quot;')
      .replaceAll("'", '&#039;');
  }

  function showMapOnly() {
    freshmanResultView.hidden = true;
    freshmanMapView.hidden = false;
    indianaControls.hidden = true;
    countySelect.value = '';
    resultHost.innerHTML = '';
  }

  function showResultOnly() {
    freshmanMapView.hidden = true;
    freshmanResultView.hidden = false;
  }

  function textFromIconParagraph(container, iconClass) {
    const p = Array.from(container.querySelectorAll('p')).find(el => el.querySelector(`i.${iconClass}`));
    return p ? p.textContent.trim() : '';
  }

  function firstMailto(container) {
    const a = container.querySelector('a[href^="mailto:"]');
    return a ? a.getAttribute('href') : '';
  }

  function buildTransferStyleCardFromCounselor(sourceEl, headingText) {
    const img = sourceEl.querySelector('img');
    const strong = sourceEl.querySelector('strong');
    const name = strong ? strong.textContent.replace(' is your Admissions Counselor!', '').trim() : 'Admissions Counselor';

    const mailto = firstMailto(sourceEl);
    const emailText = mailto ? mailto.replace('mailto:', '') : '';

    const phoneText = textFromIconParagraph(sourceEl, 'fa-phone');
    const phoneMatch = phoneText.match(/(\d{3}-\d{3}-\d{4})/);
    const phone = phoneMatch ? phoneMatch[1] : '';

    const calendlyP = Array.from(sourceEl.querySelectorAll('p')).find(el => el.querySelector('i.fa-calendar-plus'));
    const scheduleLinkEl = calendlyP ? calendlyP.querySelector('a[href]') : null;
    const scheduleLink = scheduleLinkEl ? scheduleLinkEl.getAttribute('href') : '';

    const getToKnowP = Array.from(sourceEl.querySelectorAll('p')).find(el => el.querySelector('i.fa-arrow-up-right-from-square'));
    const getToKnowLinkEl = getToKnowP ? getToKnowP.querySelector('a[href]') : null;
    const getToKnowLink = getToKnowLinkEl ? getToKnowLinkEl.getAttribute('href') : '';

    const smsText = textFromIconParagraph(sourceEl, 'fa-comment-sms');
    const smsMatch = smsText.match(/(\d{3}-\d{3}-\d{4})/);
    const sms = smsMatch ? smsMatch[1] : '';

    const noteEl = sourceEl.querySelector('em');
    const note = noteEl ? noteEl.textContent.trim() : '';

    const imgHtml = img
      ? `<img src="${escapeHtml(img.getAttribute('src') || '')}" alt="${escapeHtml(img.getAttribute('alt') || name)}" class="rounded-circle flex-shrink-0" style="width:72px;height:72px;object-fit:cover;" />`
      : '';

    const contactLines = [
      emailText ? `<div class="small">Email: <a href="${escapeHtml(mailto)}">${escapeHtml(emailText)}</a></div>` : '',
      phone ? `<div class="small">Phone: <a href="tel:+1${escapeHtml(phone.replaceAll('-', ''))}">${escapeHtml(phone)}</a></div>` : '',
      sms ? `<div class="small">Text: <a href="sms:+1${escapeHtml(sms.replaceAll('-', ''))}">${escapeHtml(sms)}</a></div>` : ''
    ].filter(Boolean).join('');

    const actions = [
      scheduleLink ? `<a class="btn btn-primary" href="${escapeHtml(scheduleLink)}" target="_blank" rel="noopener" role="button">Schedule a Chat</a>` : '',
      getToKnowLink ? `<a class="btn btn-outline-primary" href="${escapeHtml(getToKnowLink)}" role="button">Get to Know</a>` : ''
    ].filter(Boolean).join('');

    return `
      <div class="card border-0 bg-light" style="border-radius:1rem;">
        <div class="card-body p-4">
          <div class="h5">${escapeHtml(headingText)}</div>
          <div class="d-flex align-items-start gap-3 mt-3">
            ${imgHtml}
            <div>
              <div class="fw-semibold">${escapeHtml(name)}</div>
              ${contactLines}
              ${note ? `<div class="small text-muted mt-2">${escapeHtml(note)}</div>` : ''}
            </div>
          </div>
          ${actions ? `<div class="d-flex flex-wrap gap-2 mt-3">${actions}</div>` : ''}
        </div>
      </div>
    `;
  }

  function renderCounselorById(counselorId, headingText) {
    resultHost.innerHTML = '';

    const source = document.getElementById(counselorId);
    if (!source) {
      resultHost.innerHTML = `<div class="alert alert-warning mb-0">We could not find counselor content.</div>`;
      showResultOnly();
      return;
    }

    if (counselorId === 'counselor6') {
      resultHost.innerHTML = `
        <div class="card border-0 bg-light" style="border-radius:1rem;">
          <div class="card-body p-4">
            <div class="h5">${escapeHtml(headingText)}</div>
            <p class="text-muted mb-0">Please email us to find your Admissions Counselor: <a href="mailto:admissions@indwes.edu">admissions@indwes.edu</a></p>
          </div>
        </div>
      `;
      showResultOnly();
      return;
    }

    resultHost.innerHTML = buildTransferStyleCardFromCounselor(source, headingText);
    showResultOnly();
  }

  const counselorIdByStateName = {
    'Alabama':'counselor5','Alaska':'counselor13','Arizona':'counselor13','Arkansas':'counselor13','California':'counselor13',
    'Colorado':'counselor13','Connecticut':'counselor5','Delaware':'counselor5','Florida':'counselor5','Georgia':'counselor5',
    'Hawaii':'counselor13','Idaho':'counselor13','Illinois':'counselor13','Indiana':'IN','Iowa':'counselor13','Kansas':'counselor13',
    'Kentucky':'counselor5','Louisiana':'counselor13','Maine':'counselor5','Maryland':'counselor5','Massachusetts':'counselor5',
    'Michigan':'counselor4','Minnesota':'counselor13','Mississippi':'counselor5','Missouri':'counselor13','Montana':'counselor13',
    'Nebraska':'counselor13','Nevada':'counselor13','New Hampshire':'counselor5','New Jersey':'counselor5','New Mexico':'counselor13',
    'New York':'counselor5','North Carolina':'counselor5','North Dakota':'counselor13','Ohio':'counselor1','Oklahoma':'counselor13',
    'Oregon':'counselor13','Pennsylvania':'counselor5','Rhode Island':'counselor5','South Carolina':'counselor5','South Dakota':'counselor13',
    'Tennessee':'counselor1','Texas':'counselor13','Utah':'counselor13','Vermont':'counselor5','Virginia':'counselor5','Washington':'counselor13',
    'West Virginia':'counselor5','Wisconsin':'counselor13','Wyoming':'counselor13'
  };

  const counselorIdByIndianaCounty = {
    'Adams County':'counselor9','Allen County':'counselor9','Bartholomew County':'counselor12','Benton County':'counselor11','Blackford County':'counselor7',
    'Boone County':'counselor11','Brown County':'counselor12','Carroll County':'counselor10','Cass County':'counselor10','Clark County':'counselor12',
    'Clay County':'counselor12','Clinton County':'counselor11','Crawford County':'counselor12','Daviess County':'counselor12','Dearborn County':'counselor12',
    'Decatur County':'counselor12','DeKalb County':'counselor9','Delaware County':'counselor11','Dubois County':'counselor12','Elkhart County':'counselor10',
    'Fayette County':'counselor11','Floyd County':'counselor12','Fountain County':'counselor11','Franklin County':'counselor11','Fulton County':'counselor10',
    'Gibson County':'counselor12','Grant County':'counselor7','Greene County':'counselor12','Hamilton County':'counselor8','Hancock County':'counselor8',
    'Harrison County':'counselor12','Hendricks County':'counselor8','Henry County':'counselor11','Howard County':'counselor7','Huntington County':'counselor9',
    'Jackson County':'counselor12','Jasper County':'counselor10','Jay County':'counselor9','Jefferson County':'counselor12','Jennings County':'counselor12',
    'Johnson County':'counselor8','Knox County':'counselor12','Kosciusko County':'counselor10','LaGrange County':'counselor9','Lake County':'counselor10',
    'LaPorte County':'counselor10','Lawrence County':'counselor12','Madison County':'counselor11','Marion County':'counselor8','Marshall County':'counselor10',
    'Martin County':'counselor12','Miami County':'counselor7','Monroe County':'counselor12','Montgomery County':'counselor11','Morgan County':'counselor11',
    'Newton County':'counselor10','Noble County':'counselor9','Ohio County':'counselor12','Orange County':'counselor12','Owen County':'counselor12',
    'Parke County':'counselor11','Perry County':'counselor12','Pike County':'counselor12','Porter County':'counselor10','Posey County':'counselor12',
    'Pulaski County':'counselor10','Putnam County':'counselor11','Randolph County':'counselor11','Ripley County':'counselor12','Rush County':'counselor11',
    'St. Joseph County':'counselor10','Scott County':'counselor12','Shelby County':'counselor8','Spencer County':'counselor12','Starke County':'counselor10',
    'Steuben County':'counselor9','Sullivan County':'counselor12','Switzerland County':'counselor12','Tippecanoe County':'counselor11','Tipton County':'counselor11',
    'Union County':'counselor11','Vanderburgh County':'counselor12','Vermillion County':'counselor11','Vigo County':'counselor12','Wabash County':'counselor7',
    'Warren County':'counselor11','Warrick County':'counselor12','Washington County':'counselor12','Wayne County':'counselor11','Wells County':'counselor9',
    'White County':'counselor10','Whitley County':'counselor9'
  };

  const stateNameByAbbr = {
    AL:'Alabama', AK:'Alaska', AZ:'Arizona', AR:'Arkansas', CA:'California', CO:'Colorado', CT:'Connecticut',
    DE:'Delaware', FL:'Florida', GA:'Georgia', HI:'Hawaii', ID:'Idaho', IL:'Illinois', IN:'Indiana',
    IA:'Iowa', KS:'Kansas', KY:'Kentucky', LA:'Louisiana', ME:'Maine', MD:'Maryland', MA:'Massachusetts',
    MI:'Michigan', MN:'Minnesota', MS:'Mississippi', MO:'Missouri', MT:'Montana', NE:'Nebraska', NV:'Nevada',
    NH:'New Hampshire', NJ:'New Jersey', NM:'New Mexico', NY:'New York', NC:'North Carolina', ND:'North Dakota',
    OH:'Ohio', OK:'Oklahoma', OR:'Oregon', PA:'Pennsylvania', RI:'Rhode Island', SC:'South Carolina',
    SD:'South Dakota', TN:'Tennessee', TX:'Texas', UT:'Utah', VT:'Vermont', VA:'Virginia', WA:'Washington',
    WV:'West Virginia', WI:'Wisconsin', WY:'Wyoming'
  };

  function buildCountyOptions(selectEl) {
    const counties = Object.keys(counselorIdByIndianaCounty).sort((a, b) => a.localeCompare(b));
    selectEl.innerHTML = [
      '<option value="" selected>Select a county…</option>',
      ...counties.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`)
    ].join('');
  }

  function showForStateAbbr(stateAbbr) {
    const stateName = stateNameByAbbr[stateAbbr];
    if (!stateName) return;

    if (stateAbbr === 'IN') {
      indianaControls.hidden = false;
      buildCountyOptions(countySelect);
      countySelect.value = '';
      resultHost.innerHTML = '';
      showResultOnly();
      return;
    }

    indianaControls.hidden = true;
    const counselorId = counselorIdByStateName[stateName] || 'counselor6';
    renderCounselorById(counselorId, `Admissions Counselor for ${stateName}`);
  }

  countySelect.addEventListener('change', () => {
    const county = countySelect.value;
    if (!county) return;
    const counselorId = counselorIdByIndianaCounty[county] || 'counselor6';
    renderCounselorById(counselorId, `Admissions Counselor for ${county}`);
  });

  backToMap.addEventListener('click', (e) => {
    e.preventDefault();
    showMapOnly();
  });

  resetBtn.addEventListener('click', () => {
    clearSelectedState();
    showMapOnly();
    setStatus('info', 'Click a state to see its Admissions Counselor');
  });

  async function loadSvg() {
    setStatus('info', 'Loading map…');

    try {
      const res = await fetch(SVG_URL, { mode: 'cors' });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      const svgText = await res.text();
      mapWrap.innerHTML = svgText;

      const svg = mapWrap.querySelector('svg');
      if (!svg) throw new Error('SVG did not load correctly');

      if (!svg.getAttribute('viewBox')) {
        const w = svg.getAttribute('width');
        const h = svg.getAttribute('height');
        if (w && h) svg.setAttribute('viewBox', `0 0 ${parseFloat(w)} ${parseFloat(h)}`);
      }

      wireUpStates(svg);
    } catch (err) {
      setStatus('error', 'Could not load the SVG. Download and host it locally, then update SVG_URL.');
      mapWrap.innerHTML = '';
      console.error(err);
    }
  }

  function wireUpStates(svg) {
    svg.querySelectorAll('[fill="none"]:not([id]), [fill="none"]:not([id]) *').forEach(el => {
      el.style.pointerEvents = 'none';
    });

    const abbrSet = new Set(Object.keys(stateNameByAbbr));

    function resolveAbbrFromId(rawId) {
      if (!rawId) return null;
      const upper = rawId.trim().toUpperCase();
      if (abbrSet.has(upper)) return upper;
      if (upper.startsWith('US-') && abbrSet.has(upper.slice(3))) return upper.slice(3);
      if (upper.startsWith('US_') && abbrSet.has(upper.slice(3))) return upper.slice(3);
      const last2 = upper.slice(-2);
      if (abbrSet.has(last2)) return last2;
      return null;
    }

    function resolveAbbrFromTitle(el) {
      const titleEl = el && el.querySelector ? el.querySelector('title') : null;
      if (!titleEl) return null;
      const name = titleEl.textContent.trim();
      for (const [abbr, stateName] of Object.entries(stateNameByAbbr)) {
        if (stateName === name) return abbr;
      }
      return null;
    }

    svg.addEventListener('click', (e) => {
      const target = e.target && e.target.closest ? e.target.closest('path, polygon, g') : null;
      if (!target) return;

      let abbr = resolveAbbrFromId(target.getAttribute('id'));
      if (!abbr) abbr = resolveAbbrFromTitle(target);

      if (!abbr) {
        setStatus('info', 'Click detected, but no state could be resolved at that point.');
        return;
      }

      clearSelectedState();
      selectedStateEl = target;
      selectedStateEl.classList.add('is-selected');
      if (selectedStateEl.blur) selectedStateEl.blur();

      setStatus('info', `Selected: ${stateNameByAbbr[abbr]}`);
      showForStateAbbr(abbr);
    });

    let detected = 0;
    svg.querySelectorAll('path, polygon, g').forEach(el => {
      let abbr = resolveAbbrFromId(el.getAttribute('id'));
      if (!abbr) abbr = resolveAbbrFromTitle(el);
      if (!abbr) return;

      detected += 1;

      el.classList.add('state-shape');
      if (el.tagName && el.tagName.toLowerCase() === 'g') {
        el.querySelectorAll('path, polygon').forEach(child => child.classList.add('state-shape'));
      }

      el.setAttribute('tabindex', '0');
      el.setAttribute('role', 'button');
      el.setAttribute('aria-label', `State: ${stateNameByAbbr[abbr]}`);
      el.addEventListener('keydown', (evt) => {
        if (evt.key === 'Enter' || evt.key === ' ') {
          evt.preventDefault();
          el.dispatchEvent(new MouseEvent('click', { bubbles: true }));
        }
      });
    });

    setStatus('success', `Map loaded. ${detected} clickable state elements detected. Click a state.`);
  }

  showMapOnly();
  loadSvg();
}


      function showForStateAbbr(abbr) {
        const stateName = stateNameByAbbr[abbr];
        if (!stateName) return;

        const counselorId = counselorIdByStateName[stateName];
        if (abbr === 'IN') {
          showResult(`<div class="card border-0 bg-light" style="border-radius:1rem;"><div class="card-body p-4">Please select your Indiana county.</div></div>`);
          return;
        }

        const source = document.getElementById(counselorId || 'counselor6');
        showResult(buildCardFromCounselor(source, `Admissions Counselor for ${stateName}`));
      }

      async function loadSvg() {
        setStatus('info', 'Loading map…');
        const res = await fetch(SVG_URL, { mode: 'cors' });
        const svgText = await res.text();
        mapWrap.innerHTML = svgText;
        const svg = mapWrap.querySelector('svg');
        if (!svg.getAttribute('viewBox')) {
          const w = svg.getAttribute('width');
          const h = svg.getAttribute('height');
          if (w && h) svg.setAttribute('viewBox', `0 0 ${parseFloat(w)} ${parseFloat(h)}`);
        }
        wireUpStates(svg);
        setStatus('success', 'Map loaded. Click a state.');
      }

      function wireUpStates(svg) {
        const abbrSet = new Set(Object.keys(stateNameByAbbr));
        svg.querySelectorAll('path, polygon, g').forEach(el => {
          const id = el.getAttribute('id') || '';
          const abbr = id.slice(-2).toUpperCase();
          if (!abbrSet.has(abbr)) return;
          el.classList.add('state-shape');
          el.addEventListener('click', () => showForStateAbbr(abbr));
        });
      }

      loadSvg();
    }

    // --- Minimal tests (run only with #test in URL) ---
    function runTests() {
      const results = [];
      const assert = (name, condition) => results.push({ name, pass: !!condition });

      // Initial state
      showStep1();
      assert('Path header hidden on initial load', pathHeader.classList.contains('d-none'));
      assert('Step 1 visible on initial load', step1.hidden === false);
      assert('Step 2A hidden on initial load', step2A.hidden === true);
      assert('Step 2B hidden on initial load', step2B.hidden === true);

      // Selecting first-time shows header and step2A
      showStep2('first-time');
      assert('Path header visible after selecting a path', !pathHeader.classList.contains('d-none'));
      assert('Step 2A visible after selecting first-time', step2A.hidden === false);

      // Start over returns to step1 and hides header
      showStep1();
      assert('Path header hidden after start over', pathHeader.classList.contains('d-none'));

      // Report
      const failed = results.filter(r => !r.pass);
      if (failed.length) {
        // eslint-disable-next-line no-console
        console.error('Prototype tests failed:', failed);
      } else {
        // eslint-disable-next-line no-console
        console.log('Prototype tests passed:', results.length);
      }
    }

    if (window.location.hash === '#test') runTests();

    // Boot
    showStep1();
  </script>
</body>
</html>



